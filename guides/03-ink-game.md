# 03-ink-game: React Ink でターミナルローグライクゲームを作る

このガイドでは、React Ink を使ってターミナル上で動作するアスキーアートのみのローグライクゲームを作成します。文字幅のズレを防ぐため、絵文字を使わずアスキー文字のみで構築します。

## 学習目標

- React Ink を使った TUI アプリケーション開発を理解する
- アスキーアートのみでゲームを表現する手法を学ぶ
- ダイクストラ法を活用した敵 AI の実装方法を習得する
- ターミナル環境での文字幅問題への対処法を理解する

## ステップ 1: プロジェクトのセットアップ

### 1-1. プロジェクトの初期化

**AI への指示:**

```
examples/03-ink-gameディレクトリを作成し、React Inkプロジェクトをセットアップしてください。
- TypeScript対応
- ESModule使用（package.jsonに"type": "module"を追加）
- React Ink最新版をインストール
- tsxを使用した開発環境の設定
```

**期待される結果:**

- React Ink 環境の構築
- TypeScript と ESModule の正しい設定
- tsx による高速な開発環境

**よくある失敗例:**

- React Ink の型定義が不足 → **結果**: @types/react 等が必要
- ESM での React 設定ミス → **結果**: JSX 変換エラー
- 絵文字の使用 → **結果**: ターミナルで文字幅がズレる

## ステップ 2: アスキーアートローグライクゲームの実装

### 2-1. 基本的なゲーム構造

**AI への指示:**

```
src/RoguelikeGame.tsxを作成し、以下の機能を持つアスキーアートのみのローグライクゲームを実装してください：

1. マップ要素（アスキー文字のみ）：
   - プレイヤー: @
   - 壁: #
   - アイテム（コイン）: $
   - 敵: E
   - 床: .

2. 10x10のグリッドマップ
3. WASDまたは矢印キーでの移動
4. アイテムを取るとポイント獲得
5. 敵に触れるとゲームオーバー

絵文字は使用せず、アスキー文字のみで実装してください。
```

**期待される結果:**

```
== ROGUELIKE DUNGEON ==
LV: 1 | SCORE: 0 | ITEMS: 3

##########
#@.....$.#
#.#####..#
#....$.E.#
#.#####..#
#........#
#.$.....E#
##########

Arrow/WASD: Move | $: Collect items | E: Avoid enemies | Q: Quit
```

**よくある失敗例:**

- 絵文字の使用 → **結果**: 文字幅のズレでマップが崩れる
- 座標系の混乱 → **結果**: 移動がおかしくなる
- 境界チェック忘れ → **結果**: 壁を通り抜ける

### 2-2. ダイクストラ法による敵 AI

**AI への指示:**

```
src/pathfinding.tsを作成し、ダイクストラ法を使った敵AIを実装してください：

1. グリッドマップをグラフに変換する関数
2. ダイクストラ法でプレイヤーへの最短経路を計算
3. 敵がプレイヤーに向かって移動（1秒ごとに1マス）
4. 複数の敵が重ならないように調整

エクスポートする関数：
- gridToGraph(map: string[][], walkableCells: Set<string>): { graph: Graph, nodes: Set<string> }
- dijkstra(graph: Graph, start: string, end: string): string[] | null
```

**期待される結果:**

- 敵がプレイヤーを追跡する賢い AI
- 障害物を避けて最短経路で移動
- 複数の敵が協調して動く

**よくある失敗例:**

- グラフ変換のミス → **結果**: 経路が見つからない
- 非同期処理の競合 → **結果**: 敵の動きがおかしい
- 敵同士の衝突処理なし → **結果**: 敵が重なる

## ステップ 3: ゲームメカニクスの拡張

### 3-1. 高度な機能の追加

**AI への指示:**

```
RoguelikeGame.tsxを拡張して以下の機能を追加してください：

1. 階層システム：
   - 全アイテム取得で次の階層へ
   - 階層ごとに敵の数と速度が増加

2. ゲーム状態の表示：
   - HP、攻撃力などのステータス
   - メッセージログ（最新3件）
   - ターン数の表示

3. UI改善：
   - Boxコンポーネントでボーダー追加
   - 色分けされた文字（プレイヤー: 緑、敵: 赤、アイテム: 黄）
   - ゲームオーバー時のリトライオプション

アスキー文字のみを使用し、絵文字は避けてください。
```

**期待される結果:**

- 完成度の高いローグライクゲーム
- 視覚的に分かりやすいアスキーアート UI
- リプレイ性のあるゲームプレイ

## ステップ 4: プロジェクトの整理

### 4-1. 単一ゲームへの集約

**AI への指示:**

```
プロジェクトを整理してください：

1. RoguelikeGame以外の不要なゲームファイルを削除
2. src/index.tsxを更新して、RoguelikeGameのみを直接起動
3. 不要なインポートと参照を削除

シンプルな構成にしてください。
```

**期待される結果:**

```tsx
// src/index.tsx
import React from "react";
import { render } from "ink";
import { RoguelikeGame } from "./RoguelikeGame.js";

render(<RoguelikeGame />);
```

## 学んだこと

1. **アスキーアートの重要性**

   - ターミナル環境では文字幅の統一が重要
   - 絵文字を避けることで表示の安定性を確保
   - 制約の中での創造的な表現

2. **React Ink の特性**

   - ターミナルでの React 開発
   - useInput フックによるキー入力処理
   - Box と Text コンポーネントでのレイアウト

3. **ゲーム開発の基礎**

   - ゲームループの実装
   - 状態管理の重要性
   - 敵 AI の実装方法

4. **アルゴリズムの応用**
   - ダイクストラ法を実用的なゲーム AI に活用
   - グリッドとグラフの変換
   - 経路探索の最適化

## トラブルシューティング

### よくある問題と解決策

1. **文字幅のズレ**

   ```
   問題: 絵文字使用でマップが崩れる
   解決: アスキー文字のみを使用
   ```

2. **ESModule エラー**

   ```
   問題: Cannot use import statement outside a module
   解決: package.jsonに"type": "module"を追加
   ```

3. **型エラー**

   ```
   問題: TypeScriptの型エラー
   解決: tsconfig.jsonでstrict: trueを設定し、適切な型定義を追加
   ```

4. **キー入力の反応**
   ```
   問題: キー入力が効かない
   解決: useInputフックの正しい使用法を確認
   ```

## ベストプラクティス

1. **アスキーアートの設計**

   - 視認性の高い文字を選択（@、#、$など）
   - 文字の意味を直感的に（#=壁、$=お金）
   - 一貫性のある文字使用

2. **ゲーム設計**

   - シンプルなルールから始める
   - 段階的に機能を追加
   - プレイヤーへのフィードバックを明確に

3. **コード構造**
   - ゲームロジックと UI の分離
   - 再利用可能な関数の作成
   - 適切なエラーハンドリング

## 発展課題

- より複雑なマップ生成アルゴリズム
- 戦闘システムの実装
- アイテムの種類追加（武器、防具、ポーション）
- セーブ・ロード機能
- スコアランキング機能

## 次のステップ

このプロジェクトで学んだ内容を基に、より複雑なターミナルアプリケーションの開発に挑戦してみましょう。アスキーアートの制約は創造性を育み、基本的なプログラミングスキルの向上につながります。
